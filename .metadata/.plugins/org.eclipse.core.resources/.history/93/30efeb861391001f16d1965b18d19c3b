
console.log("board_detail.js in !!!");
console.log(bnoVal);

// 등록

// 등록 버튼을 누르면 작성자와 댓글 내용의 값을 객체로 생성 => 서버로 controller로 전송
document.getElementById('cmtAddBtn').addEventListener('click', () => {
	let cmtText = document.getElementById('cmtText').value;
	let cmtWriter = document.getElementById('cmtWriter').value;

	if (cmtText == null || cmtText == '') {
		alert("댓글을 입력해주세요.");
		return false;
	}
	// 댓글 객체 생성

	let cmtData = {
		bno: bnoVal,
		writer: cmtWriter,
		content: cmtText
	}
	// 댓글을 비동기로 전송	
	postCommentToserver(cmtData).then(result => {
		console.log(result); // isOK
		if (result == '1') {
			alert("댓글등록 성공");
		} else {
			alert("댓글등록 실패")
		}
	})
	// 댓글 출력
	getCommentListFromServer(bnoVal).then(result => {
		console.log(result);
	})

});


function printCommentList(result){
	let div = document.getElementById('commentLine');
	div.innerText=''; // 기존에 값이 있다면... 구조 지우기
	for(let i =0; i < result.length; i++){
		let html = `<div>`;	
		html += `<div>${result[i].cno}, ${result[i].bno}, ${result[i].writer}, ${result[i].regdate}</div>`;
	}
}

/*

			<div>
				<button>수정</button>
				<button>삭제</button>
				<br> <input type="text" value="content">
			</div>
		</div>
	</div>
*/


// 화면에서 데이터를 만들어서 보내는 방법 = post
// 데이터를 보낼때 method=post, headers(Content-Type), body 를 작성해서 전송
// 서버에서 데이터를 주는 방법 = get
// Content-Type : application/json; charset=utf-8

async function postCommentToserver(cmtData) {
	try {
		console.log(cmtData);
		const url = "/cmt/post";
		const config = {
			method: 'post',
			headers: {
				'Content-Type': 'application/json; charset=utf-8'
			},
			body: JSON.stringify(cmtData)
		}
		const resp = await fetch(url, config);
		const result = await resp.text(); // isOk 값을 text로 리턴 
		return result;
	} catch (error) {
		console.log(error);
	}
};

// list 가져오기 : 내 게시글에 달린 댓글만 가져오기 => get (생략가능)
async function getCommentListFromServer(bno){
	try{
		const resp = await fetch("/cmt/list?bno="+bno);
		const result = await resp.json(); // 댓글 리스트 [{...},{...}]
		return result; 
		
	} catch (error){
		console.log(error);
	}
};














